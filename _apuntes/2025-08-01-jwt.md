---
title: JWT
modulo: M3 - Ataques Web
fecha: 2025-08-01
layout: apunte
---
# **Teor√≠a de JWT**
**JWT (JSON Web Token)** es un est√°ndar para enviar informaci√≥n segura entre dos partes como un objeto JSON.

üìå **Se usa sobre todo para autenticaci√≥n**:
- El servidor genera un token con datos del usuario (claims).    
- El cliente lo guarda (normalmente en `localStorage` o `cookies`).    
- En cada petici√≥n lo env√≠a para demostrar que est√° autenticado.    

**Ejemplo de uso t√≠pico**:
1. Te logueas ‚Üí el servidor te manda un JWT.    
2. Cada vez que accedes a `/perfil` o `/compras`, env√≠as el JWT en la cabecera `Authorization: Bearer <token>`.    
3. El servidor lo valida sin tener que consultar la base de datos (por eso son r√°pidos).

Un JWT es un string con 3 partes separadas por puntos:

```
xxxxx.yyyyy.zzzzz 
(header).(payload).(signature)
```

**Ejemplo real**:
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJ1c2VyIjoiYWxpY2UiLCJyb2wiOiJhZG1pbiJ9.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

üîπ **Header** (metadatos, algoritmo de firma, tipo de token):

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

üîπ **Payload** (datos que quieres enviar, llamados _claims_):

```json
{
  "user": "alice",
  "rol": "admin",
  "exp": 1734567890
}
```

üîπ **Signature** (firma para que nadie lo altere):
```
HMACSHA256(
   base64UrlEncode(header) + "." + base64UrlEncode(payload),
   secret
)
```

## **Tipos de Claims**
Los claims son los datos del payload. Hay 3 tipos:

1. **Registered claims** (est√°ndar, recomendados):    
    - `iss` ‚Üí qui√©n emiti√≥ el token.        
    - `sub` ‚Üí sujeto (usuario).        
    - `aud` ‚Üí audiencia (para qui√©n es v√°lido).        
    - `exp` ‚Üí fecha de expiraci√≥n.        
    - `iat` ‚Üí emitido en.        
    - `nbf` ‚Üí ‚Äúnot before‚Äù, desde cu√°ndo es v√°lido.

2. **Public claims** ‚Üí datos que cualquiera puede entender (`name`, `email`, etc.).

3. **Private claims** ‚Üí personalizados (e.g., `rol: admin`).

**Ojo:** El payload **NO est√° cifrado**, solo **codificado en base64**. Cualquiera puede verlo, pero no deber√≠a poder modificarlo porque se rompe la firma.

## **Ventajas**
‚úÖ No necesitas mantener sesiones en el servidor (es _stateless_).  
‚úÖ Escalabilidad (ideal para microservicios).  
‚úÖ R√°pido, porque no tienes que consultar base de datos siempre.

---

## **Desventajas / Riesgos**
‚ö†Ô∏è **El payload es legible** ‚Üí no metas contrase√±as ni datos sensibles.  
‚ö†Ô∏è **Si se filtra el secret o clave privada** ‚Üí cualquiera puede falsificar tokens.  
‚ö†Ô∏è **Dif√≠cil revocar** ‚Üí si alguien roba un JWT, es v√°lido hasta que expire (a menos que uses listas negras).  
‚ö†Ô∏è **Errores comunes en la validaci√≥n** ‚Üí ataques de _alg=none_, cambio de algoritmo, etc.

# **NONE alg attack**
Un JWT se firma para que el servidor sepa que **nadie lo modific√≥**.  
El **algoritmo (`alg`)** en el header indica c√≥mo verificar la firma (`HS256`, `RS256`, etc.).

Pero‚Ä¶ si en el header dices:
```json
{
  "alg": "none",
  "typ": "JWT"
}
```

Est√°s diciendo: **‚ÄúNo necesito firma‚Äù**.

Si el servidor **no valida correctamente** y conf√≠a en ese `alg: none`, **aceptar√° cualquier token modificado**.

## **Ejemplo**
Partimos del siguiente JWT
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
.eyJ1c2VyIjoiYWxpY2UiLCJyb2wiOiJ1c2VyIn0
.abcd1234firmafalsa
```

El cual tiene el siguiente payload (decodificado):
```json
{
  "user": "alice",
  "rol": "user"
}
```

Nuestro objetivo es ser **admin**, entonces modificamos el header y el payload:
```json
// Nuevo Header
{
  "alg": "none",
  "typ": "JWT"
}

// Nuevo Payload
{
  "user": "alice",
  "rol": "admin"
}
```

Ahora solo codificamos en Base64URL, sin firma:
```
eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0
.eyJ1c2VyIjoiYWxpY2UiLCJyb2wiOiJhZG1pbiJ9.
```
(N√≥tese el tercer punto ‚Üí firma vac√≠a).

Enviamos este nuevo token al servidor. Si la app est√° mal configurada y no verifica la firma cuando ve `alg:none`, toma como valido el privilegio de **admin**.